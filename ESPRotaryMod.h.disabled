/////////////////////////////////////////////////////////////////
/*
  ESP8266/Arduino Library for reading rotary encoder values.
  Copyright 2017 Lennart Hennigs
*/
/////////////////////////////////////////////////////////////////
#pragma once

#ifndef ESPRotaryMod_h
#define ESPRotaryMod_h

/////////////////////////////////////////////////////////////////

#include "Arduino.h"
#include "Adafruit_MCP23017.h"
/////////////////////////////////////////////////////////////////

#define RE_RIGHT            1
#define RE_LEFT             255

/////////////////////////////////////////////////////////////////
// typedef void (*ESPRotaryMod)();
class ESPRotaryMod {
 protected:
    Adafruit_MCP23017 mcp;
    int pin1, pin2, position, last_position, steps_per_click, lower_bound, upper_bound;
    unsigned long last_read_ms;
    byte direction;
    byte state;

    typedef void (*CallbackFunction) (ESPRotaryMod&);
    CallbackFunction change_cb = NULL;
    CallbackFunction right_cb = NULL;
    CallbackFunction left_cb = NULL;

 public:
    ESPRotaryMod(Adafruit_MCP23017 mcp, int pin1, int pin2, int steps_per_click = 1, int lower_bound = -32768, int upper_bound = 32768);

    int getPosition();
    void resetPosition(int p = 0);
    byte getDirection();
    
    void setStepsPerClick(int steps);
    int getStepsPerClick();

    String directionToString(byte direction);    
    void setChangedHandler(CallbackFunction f);
    void setRightRotationHandler(CallbackFunction f);
    void setLeftRotationHandler(CallbackFunction f);

    void loop();
};

/////////////////////////////////////////////////////////////////
#endif
/////////////////////////////////////////////////////////////////
